#!/usr/bin/env bash
# Author: Bruno Guimarães
# Description: Depends on: https://github.com/adi1090x/rofi
# Version: 1.0
# Last Updated: 2025-12-19

set -euo pipefail
IFS=$'\n\t'

# ──────────────────────────────────────────────────────────────────────────────
# Constants / Config
# ──────────────────────────────────────────────────────────────────────────────
# Import Rofi Theme
readonly SCRIPT_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")/.." && pwd)"
source "$SCRIPT_DIR/lib/rofi-theme.sh"

# ──────────────────────────────────────────────────────────────────────────────
# Functions
# ──────────────────────────────────────────────────────────────────────────────
operation_cmd() {
  # Import Theme
  local type="$HOME/.config/rofi/applets/type-1"
  local style='style-3.rasi'
  local theme="$type/$style"
  rofi -theme-str 'window {location: center; anchor: center; fullscreen: false; width: 350px;}' \
    -theme-str 'mainbox {orientation: vertical; children: [ "message", "listview" ];}' \
    -theme-str 'listview {columns: 2; lines: 1;}' \
    -theme-str 'element-text {horizontal-align: 0.5;}' \
    -theme-str 'textbox {horizontal-align: 0.5;}' \
    -dmenu \
    -p 'Confirmation' \
    -mesg 'Turn the container' \
    -theme ${theme}
}

# ──────────────────────────────────────────────────────────────────────────────
# Main
# ──────────────────────────────────────────────────────────────────────────────
main() {
  local choice=$(for f in ~/.utils/DockerContainers/*.yml; do basename "${f%.yml}"; done | rofi_cmd)
  [[ -z "$choice" ]] && exit 0

  local operation="$(echo -e "Up\nDown" | operation_cmd)"
  [[ -z "$operation" ]] && exit 0

  if [[ "$operation" == "Up" ]]; then
    docker compose -p "$choice" -f ~/.utils/DockerContainers/${choice}.yml up -d
  elif [[ "$operation" == "Down" ]]; then
    docker compose -p "$choice" -f ~/.utils/DockerContainers/${choice}.yml down
  fi
}

# ──────────────────────────────────────────────────────────────────────────────
# Entry Point
# ──────────────────────────────────────────────────────────────────────────────
# Only run main if script is executed (not sourced)
[[ "${BASH_SOURCE[0]}" == "${0}" ]] && main "$@"
