#!/usr/bin/env bash

## Author  : Bruno GuimarÃ£es - fork from -> Aditya Shakya (adi1090x)
# Depends on: https://github.com/adi1090x/rofi

# Import Rofi Theme
SCRIPT_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")/.." && pwd)"
source "$SCRIPT_DIR/lib/rofi_cmd.sh"

# Operation CMD
operation_cmd() {
  # Import Theme
  type="$HOME/.config/rofi/applets/type-1"
  style='style-3.rasi'
  theme="$type/$style"
  rofi -theme-str 'window {location: center; anchor: center; fullscreen: false; width: 350px;}' \
    -theme-str 'mainbox {orientation: vertical; children: [ "message", "listview" ];}' \
    -theme-str 'listview {columns: 2; lines: 1;}' \
    -theme-str 'element-text {horizontal-align: 0.5;}' \
    -theme-str 'textbox {horizontal-align: 0.5;}' \
    -dmenu \
    -p 'Confirmation' \
    -mesg 'Turn the container' \
    -theme ${theme}
}

CHOICE=$(for f in ~/.utils/DockerContainers/*.yml; do basename "${f%.yml}"; done | rofi_cmd)
[[ -z "$CHOICE" ]] && exit 0

OPERATION="$(echo -e "Up\nDown" | operation_cmd)"
[[ -z "$OPERATION" ]] && exit 0

if [[ "$OPERATION" == "Up" ]]; then
  docker-compose -f ~/.utils/DockerContainers/${CHOICE}.yml up -d
elif [[ "$OPERATION" == "Down" ]]; then
  docker-compose -f ~/.utils/DockerContainers/${CHOICE}.yml down
else
  exit
fi
