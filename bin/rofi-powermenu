#!/usr/bin/env bash
# Author: Bruno Guimarães
# Description:
# Version: 1.0
# Last Updated: 2026-01-05

set -euo pipefail
IFS=$'\n\t'

# ──────────────────────────────────────────────────────────────────────────────
# Constants / Config
# ──────────────────────────────────────────────────────────────────────────────
# Import Theme
readonly TYPE="$HOME/.config/rofi/applets/type-1"
readonly STYLE='style-3.rasi'
readonly THEME="$TYPE/$STYLE"

declare -A MENU=(
  [" Lock"]="betterlockscreen -l"
  [" Logout"]="kill -9 -1"
  [" Suspend"]="mpc -q pause && pactl set-sink-mute @DEFAULT_SINK@ 1 && systemctl suspend"
  [" Hibernate"]="systemctl hibernate"
  [" Reboot"]="systemctl reboot"
  [" Shutdown"]="systemctl poweroff"
)

# ──────────────────────────────────────────────────────────────────────────────
# Functions
# ──────────────────────────────────────────────────────────────────────────────
rofi_cmd() {
  local theme="$1"
  # Theme Elements
  local prompt="$(hostname)"
  local mesg="Uptime : $(uptime -p | sed -e 's/up //g')"
  local list_col='1'
  local list_row='6'

  rofi -theme-str "listview {columns: $list_col; lines: $list_row;}" \
    -theme-str 'textbox-prompt-colon {str: "";}' \
    -dmenu \
    -p "$prompt" \
    -mesg "$mesg" \
    -markup-rows \
    -theme ${theme}
}

# Confirmation CMD
confirm_cmd() {
  local theme="$1"
  rofi -theme-str 'window {location: center; anchor: center; fullscreen: false; width: 350px;}' \
    -theme-str 'mainbox {orientation: vertical; children: [ "message", "listview" ];}' \
    -theme-str 'listview {columns: 2; lines: 1;}' \
    -theme-str 'element-text {horizontal-align: 0.5;}' \
    -theme-str 'textbox {horizontal-align: 0.5;}' \
    -dmenu \
    -p 'Confirmation' \
    -mesg 'Are you Sure?' \
    -theme ${theme}
}

# Confirm and execute
confirm_run() {
  selected="$(echo -e "yes\nno" | confirm_cmd "$THEME" )"
  if [[ "$selected" == "yes" ]]; then
    eval "$1"
  else
    return 1
  fi
}

# ──────────────────────────────────────────────────────────────────────────────
# Main
# ──────────────────────────────────────────────────────────────────────────────
main() {
  local choice=$(printf "%s\n" "${!MENU[@]}" | rofi_cmd "$THEME" )
  [[ -z "$choice" ]] && exit 0

  confirm_run "${MENU[$choice]}"
}

# ──────────────────────────────────────────────────────────────────────────────
# Entry Point
# ──────────────────────────────────────────────────────────────────────────────
# Only run main if script is executed (not sourced)
[[ "${BASH_SOURCE[0]}" == "${0}" ]] && main "$@"
